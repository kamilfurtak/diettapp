<div class="h-screen w-screen bg-gray-900 flex flex-col font-sans text-gray-100">
  @if (mealService.loading()) {
    <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm flex items-center justify-center z-50">
      <div class="flex flex-col items-center space-y-4">
        <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-lime-500"></div>
        <p class="text-lg font-semibold text-gray-200">Loading your data...</p>
      </div>
    </div>
  }

  @if (view() === 'add' || view() === 'plan') {
    <header class="bg-gray-800 shadow-md w-full sticky top-0 z-40">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <button (click)="showLogView()" class="text-lime-400 hover:text-lime-300 transition-colors">
            <ion-icon name="arrow-back-outline" class="text-2xl"></ion-icon>
          </button>
          <h1 class="text-xl font-bold tracking-tight">
            {{ view() === 'add' ? 'Add Meal' : 'Set Diet Plan' }}
          </h1>
          <div class="w-8"></div> <!-- Spacer -->
        </div>
      </div>
    </header>
  }

  <main class="flex-1 overflow-y-auto no-scrollbar" [class.pb-32]="view() === 'log'">
    @switch (view()) {
      @case ('log') {
        <app-meal-log
          (addMealRequest)="showAddMealView($event)"
          (editPlanRequest)="showPlanView()" />
      }
      @case ('add') {
        <!-- The '!' is safe because this component is only rendered when a category is selected -->
        <app-add-meal
          [category]="selectedCategory()!"
          (mealAdded)="showLogView()"
          (close)="showLogView()" />
      }
      @case ('plan') {
        <app-diet-plan (close)="showLogView()" />
      }
    }
  </main>

  @if (view() === 'log') {
    <footer class="fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 h-16 flex items-center justify-around z-30">
      <button class="flex flex-col items-center justify-center text-lime-400 w-1/5">
        <ion-icon name="restaurant-outline" class="text-2xl"></ion-icon>
        <span class="text-xs font-medium">Log</span>
      </button>
      <button class="flex flex-col items-center justify-center text-gray-400 opacity-50 w-1/5">
        <ion-icon name="book-outline" class="text-2xl"></ion-icon>
        <span class="text-xs">Recipes</span>
      </button>
      <button (click)="showAddMealView('Snacks')" class="flex flex-col items-center justify-center text-gray-400 w-1/5">
        <ion-icon name="add-circle" class="text-6xl text-lime-400 -mt-8 bg-gray-800 p-1 rounded-full"></ion-icon>
      </button>
      <button class="flex flex-col items-center justify-center text-gray-400 opacity-50 w-1/5">
        <ion-icon name="stats-chart-outline" class="text-2xl"></ion-icon>
        <span class="text-xs">Stats</span>
      </button>
      <button (click)="showPlanView()" class="flex flex-col items-center justify-center text-gray-400 hover:text-lime-400 transition-colors w-1/5">
        <ion-icon name="document-text-outline" class="text-2xl"></ion-icon>
        <span class="text-xs">Plans</span>
      </button>
    </footer>
  }
</div>
